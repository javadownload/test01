

--------------  bookList4.jsp 검색 폼 -----


<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" %>
    
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Book List</title>
<link rel="stylesheet" href="./css/table.css">

<script type="text/javascript">
   function f1() {
	   return confirm("삭제 할거니?");
   }
</script>

</head>
<body>
<h1>Book List</h1>

<br>
<form action="${pageContext.request.contextPath}/search.do" method="post">
    <table>
        <tr align="right">
           <td>
              <select name="condition">
                  <option value="title">도서제목</option>
                  <option value="publisher">출판사</option>
              </select>
              <input type="text" name="keyword">
              <input type="submit" value="검색">
           </td>
        </tr>
    </table>
</form>
<hr>

<form action="deleteBook.do" method="get">
<table class="tableb">
	<tr><th>bookno</th> <th>title</th><th>publisher</th><th>price</th> 
	              <th><input type="submit" value="삭제" onclick="return f1()"> </th></tr>
	
	<c:forEach  var="data"  items="${bookList}">
	   <tr>
	       <td>${data.bookno}  </td>
	       <td><a href="viewBook.do?bookno=${data.bookno}"> ${data.title} </a>  </td>
	       <td>${data.publisher}  </td>
	       <td>${data.price}  </td>
	       <td> <input type="checkbox" name="bookno" value="${data.bookno}"> </td>
	       
	   </tr>
	</c:forEach>
	
	</table>
</form>

</body>
</html>


--------------ebServlet({ "/search.do" })---------------------------

package servlet;

@WebServlet({ "/search.do" })
public class SearchBookServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void service(HttpServletRequest request, 
			               HttpServletResponse response) 
					throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");
		response.setContentType("text/html;charset=utf-8");
      
		
//		HttpSession session = request.getSession();
//        String login = (String) session.getAttribute("login");
//        System.out.println("login : "+login);
//		if(login == null) {
//			//response.sendRedirect("login.jsp");
//	         request.setAttribute("msg", "login이 필요합니다.");
//
//			getServletContext().
//			getRequestDispatcher("/login.jsp").
//			forward(request, response);
//			return;
//		}


        String condition = request.getParameter("condition");
        String keyword = request.getParameter("keyword");
		
		BookDAO dao = new BookDAO_Mariadb();
		BookService service = new BookServiceImpl(dao);
		List<BookVO> list = service.searchBook(condition, keyword);
		
		list.forEach(i -> System.out.println(i));
		
		//PrintWriter out = response.getWriter();
		
		//list.forEach(i -> out.print("<h3>"+i+"</h3>"));

		
		request.setAttribute("bookList", list);
		
		getServletContext().
		getRequestDispatcher("/bookList4.jsp").
		forward(request, response);
		
	}

}






